[% USE date(format = c.cobrand.bin_day_format) %]
[% USE pounds = format('%.2f'); ~%]
[% PROCESS 'waste/header.html' %]
[% PROCESS 'govuk/fields.html' ~%]

[% PROCESS errors %]
[% SET data = form.saved_data ~%]


<h1 class="govuk-heading-xl govuk-!-margin-bottom-9">Request a bulky waste collection</h1>
<div class="bulky__summary">
  <h2 class="govuk-heading-l govuk-!-margin-bottom-5">Booking Summary</h2>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-warning-text due">
        <div class="govuk-warning-text__img">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        </div>
        <div class="govuk-warning-text__content">
            <span class="govuk-warning-text__assistive">Warning</span>
              <p class="govuk-!-margin-bottom-0">Please read carefully all the details for your booking. You won't be
                able to amend your details afterwards.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h3>Property details</h3>
      [% INCLUDE 'waste/_address_display_bulky_summary.html' %]

      <hr>
      <h3>Collection date</h3>
      <dl>
          <dt>Date</dt>
          <dd>[% cobrand.bulky_nice_collection_date(data.chosen_date) %]</dd>
      </dl>

      <div class="govuk-warning-text due">
        <div class="govuk-warning-text__img">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        </div>
        <div class="govuk-warning-text__content">
            <span class="govuk-warning-text__assistive">Warning</span>
            <p class="govuk-!-margin-bottom-3">You can cancel this booking till
              23:55hrs on the 2nd of August 2022. [% #XXX calculate cut off when we do cancellations  %]</p>
            <p class="govuk-!-margin-bottom-0">You can get a refund by cancelling 24hrs
               before the day of collection.</p>
        </div>
      </div>

      <hr>
      <h3>Items to be collected</h3>
      [% items = [] %]
      [% FOR item_key IN data.keys.grep('^item_[\d]+$').sort %]
        [% item = data.$item_key; NEXT UNLESS item %]
        [% items.push(item) %]
      [% END %]
      <dl>
        <dt>Price</dt>
        [% payment = cobrand.bulky_total_cost(data) %]
        <dd>Â£[% pounds(payment / 100) %]</dd>
      </dl>
      <div class="govuk-!-margin-bottom-4">
        <p class="govuk-!-margin-bottom-0">[% items.size %] item[% 's' IF items.size > 1 %] requested for collection.</p>
        [% remaining = cobrand.bulky_items_maximum - items.size %]
        <small >([% remaining %] remaining slot[% 's' IF remaining > 1 %] available)</small>
      </div>

      <table class="item-summary-table govuk-!-margin-bottom-9">
        <thead>
          <tr>
              <th></th>
              <th>Item</th>
              <th>
                <span class="govuk-text__assistive">Item images preview</span>
              </th>
          </tr>
        </thead>
        <tbody>
          [% FOR item IN items %]
          [% extra_text = form.items_extra.${item.item}.message %]
          <tr [% IF extra_text %]class="is--no-border-bottom"[% END %]>
              <td class="item-number-cell">[% loop.index + 1 %]</td>
              <td>
                <p class="govuk-!-margin-bottom-0">[% item.item %]</p>
              </td>
              <td>
                  [% IF item.photo_fileid %]
                    <img class="img-preview is--small" alt="Preview image succesfully attached" src="/photo/temp.[% item.photo_fileid %]">
                  [% ELSE %]
                    <span class="govuk-text__assistive">No image attached for this item</span>
                  [% END %]
              </td>
          </tr>
          [% IF extra_text %]
            <tr>
              <td colspan="3">
                <div class="govuk-warning-text due" style="padding:1em">
                  <div class="govuk-warning-text__img">
                    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                  </div>
                  <div class="govuk-warning-text__content" style="display:flex; align-items:center;">
                      <span class="govuk-warning-text__assistive">Warning for item: [% item.item %]</span>
                      <p class="govuk-!-margin-bottom-0">[% extra_text %]</p>
                  </div>
                </div>
              </td>
            </tr>
          [% END %]
        [% END %]
        </tbody>
      </table>


      <h3>Location details</h3>
      <p>
        [% IF data.location %]
          [% data.location %]
        [% ELSE %]
          No description provided.
        [% END %]
      </p>
      [% IF data.location_photo_fileid %]
        <img class="img-preview is--medium" alt="Preview image succesfully attached" src="/photo/temp.[% data.location_photo_fileid %]">
      [% ELSE %]
        <p class="due" style="padding:1em">No image of the location has been attached.</p>
      [% END %]
    </div>

    <div class="govuk-grid-column-one-third">
      <h3>Your details</h3>
      <dl>
        <dt>Name</dt>
        <dd>[% data.name %]</dd>
        <dt>Email</dt>
        <dd>[% data.email %]</dd>
        <dt>Phone</dt>
        <dd>[% data.phone OR 'Not given' %]</dd>
      </dl>
    </div>
  </div>

  <form class="waste" method="post">
    [% PROCESS form %]
  </form>

</div>
[% INCLUDE footer.html %]
